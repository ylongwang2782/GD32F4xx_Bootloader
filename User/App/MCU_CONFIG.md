# STM32F4系列MCU配置指南

这个bootloader支持多种STM32F4系列芯片，会根据编译时的芯片定义自动配置RAM大小。

## 🔧 支持的芯片和RAM配置

### 自动识别的芯片

| 芯片型号 | 编译宏定义 | RAM大小 | RAM范围 |
|---------|-----------|---------|---------|
| STM32F429xx | `STM32F429xx` | 256KB | 0x20000000-0x20040000 |
| STM32F439xx | `STM32F439xx` | 256KB | 0x20000000-0x20040000 |
| STM32F469xx | `STM32F469xx` | 384KB | 0x20000000-0x20060000 |
| STM32F479xx | `STM32F479xx` | 384KB | 0x20000000-0x20060000 |
| STM32F446xx | `STM32F446xx` | 128KB | 0x20000000-0x20020000 |
| STM32F407xx | `STM32F407xx` | 192KB | 0x20000000-0x20030000 |
| STM32F417xx | `STM32F417xx` | 192KB | 0x20000000-0x20030000 |

### 默认配置（其他芯片）
- **RAM大小**: 768KB
- **RAM范围**: 0x20000000-0x200C0000

## 🛠️ 如何适配新芯片

### 方法1：修改ymodem.h文件（推荐）

在`User/App/ymodem.h`文件中添加新的芯片配置：

```c
#elif defined(STM32F767xx)  /* 新增芯片 */
    #define RAM_SIZE_KB         512
    #define RAM_END_ADDR        0x20080000  /* 512KB */
```

### 方法2：编译时定义（临时方案）

在编译选项中添加：
```bash
-DRAM_SIZE_KB=768 -DRAM_END_ADDR=0x200C0000
```

### 方法3：使用默认配置

如果不确定具体芯片型号，默认配置会使用768KB，应该能覆盖大部分大容量芯片。

## 📋 常见STM32F4系列RAM配置

| 芯片系列 | 典型型号 | RAM大小 | 结束地址 |
|----------|----------|---------|----------|
| STM32F401 | F401CC/CE | 64KB | 0x20010000 |
| STM32F411 | F411CE/RE | 128KB | 0x20020000 |
| STM32F405/407 | F407VG | 192KB | 0x20030000 |
| STM32F415/417 | F417VG | 192KB | 0x20030000 |
| STM32F427/429 | F429ZI | 256KB | 0x20040000 |
| STM32F437/439 | F439ZI | 256KB | 0x20040000 |
| STM32F446 | F446RE | 128KB | 0x20020000 |
| STM32F469/479 | F469NI | 384KB | 0x20060000 |
| STM32F7系列 | F767ZI | 512KB | 0x20080000 |

## 🔍 运行时检查

bootloader启动时会显示检测到的RAM配置：

```
MCU RAM Configuration: 768 KB (0x20000000 - 0x200C0000)
Validation results:
  Stack valid: YES (0x200B0000)
  Reset valid: YES (0x08010F99)
  Not empty: YES
```

## ⚠️ 注意事项

1. **确保应用程序链接脚本匹配**：应用程序的链接脚本中RAM大小必须与实际芯片匹配
2. **栈大小配置**：确保栈不会超出RAM范围
3. **编译器宏定义**：确保编译时正确定义了芯片型号宏

## 🚀 快速适配步骤

1. **确认芯片型号**：查看芯片丝印或数据手册
2. **查表找配置**：在上表中找到对应的RAM配置
3. **修改配置文件**：
   - 如果芯片已支持：无需修改
   - 如果芯片未支持：在`ymodem.h`中添加配置
4. **重新编译**：确保使用正确的芯片定义编译
5. **验证运行**：检查bootloader启动时显示的RAM配置是否正确
